<!DOCTYPE html>
<html>
<head>
	<title>Quinn James Online</title>
	<meta charset="UTF-8">
</head>
<body>
	<div id="parent" style="position:relative; cursor:none; font-family:'Lucida Console', monospace; font-size:12px; line-height:12px; width:151ch; margin:auto;">
		<iframe id=frame src=" " allowfullscreen="" style="top:296px;left:504px;position:absolute;z-index:-1;" width="372" height="225" frameborder="0" scrolling="no"></iframe>
		<img id=image src="" style="top:296px;left:504px;position:absolute;z-index:-1;display:none;" width="372" height="225"/>
		<div id="main"></div>
	</div>
	
	<script>		
		const outputWidth = 150;
		const outputHeight = 50;
		const main = document.getElementById("main");
		const frame = document.getElementById("frame");
		const image = document.getElementById("image");
		const parent = document.getElementById("parent");
		var o = new Array(); //array to be output when blit() is called
		var mouse = {x:0,y:0,oldX:0,oldY:0,under:'┌',cursor:'█'}; //cursor style and location
		var draw = {drawInvert:false,hitbox:0,foreground:"silver",background:"black"}; //display/color related vars
		var hitboxes = []; //all clickables in current frame
		var pageIndex = -1; //current pageID displayed
		var pageImg = true; //display video/image on content draw
		var texts; //json of all texts for content
		var pages; //pages Enabled, posx, posy, width, height, text, [links hitx1, hity1, hitx2, hity2, togglepage, setcontentwindowpage, enablepage, disablepage, openlink]
		var terminal = {lines:0, width:0, text:"", prevText:["Terminal functionality is still under development."], prevCommands:new Array(), commands:[]};
		var simpleResponseCommands = [
			["CD","No disk inserted. Please insert a disk and try again."],
			["LS","Error at /usr/share/Adobe/doc/example/amdroid_vm/root/sbin/ls.jar: Device is not responding. Try 'LSD' instead."],
			["HELLO","hi"],
			["HI","how are ya?"],
			["ROBLOX","oof"],
			["LINUX","Ign http://us.archive.ubuntu.com trusty InRelease Get:1 http://us.archive.ubuntu.com trusty-updates InRelease [65.9 kB] Hit http://ppa.launchpad.net trusty InRelease Get:2 http://security.ubuntu.com trusty-security InRelease [65.9 kB] Hit http://us.archive.ubuntu.com trusty-backports InRelease Hit http://us.archive.ubuntu.com trusty Release.gpg Get:3 http://us.archive.ubuntu.com trusty-updates/main Sources [416 kB] Hit http://ppa.launchpad.net trusty/main amd64 Packages Get:4 http://us.archive.ubuntu.com trusty-updates/restricted Sources [322 B] Get:5 http://us.archive.ubuntu.com trusty-updates/universe Sources [200 kB] Get:6 http://us.archive.ubuntu.com trusty-updates/multiverse Sources [386 B] Get:7 http://security.ubuntu.com trusty-security/main Sources [154 kB] Get:8 http://us.archive.ubuntu.com trusty-updates/main amd64 Packages [176 kB] Hit http://ppa.launchpad.net trusty/main i386 Packages Get:9 http://us.archive.ubuntu.com trusty-updates/restricted amd64 Packages [17.2 kB] Get:10 http://us.archive.ubuntu.com trusty-updates/universe amd64 Packages [453 kB] Get:11 http://us.archive.ubuntu.com trusty-updates/multiverse amd64 Packages [14.6 kB] Get:12 http://us.archive.ubuntu.com trusty-updates/main i386 Packages [118 kB] Fetched 7,265 kB in 4s (1,534 kB/s) Reading package lists... Done"],
			["SUDO","Sudo make me a sandwich."],
			["APT-GET","Error: Repository list could not be read. Please reinstall apt to load repositories."],
			["APT","Error: Repository list could not be read. Please reinstall apt to load repositories."],
			["VI","Due to GNU GPL issues, vim can no longer be offered for web users."],
			["VIM","Due to GNU GPL issues, vim can no longer be offered for web users."],
			["EMACS","Loading..."],
			["","Welcome to null island. Current populaion: NaN"],
			["MINECRAFT","Bro do you even Java"],
			["FOOD","Food machine broke."],
			["LA","The note that follows SO"],
			["SO","So what?"],
			["STAR","That subcommand word better be WARS."],
			["XKCD","Yeah I use way too many references"],
			["OPEN", "I'm sorry Dave. I'm afraid I can't do that."],
			["CMD","CMD is no longer supported. Try 'POWERSHELL' instead."],
			["POWERSHELL","POWERSHELL is out of date. Use 'POWERSHELL-X64' instead."],
			["POWERSHELL-X64","Due to security concerns, POWERSHELL-X64 can no longer modify system settings. Use 'CONTROL-PANEL' instead."],
			["CONTROL-PANEL","CONTROL-PANEL is legacy. Use 'SETTINGS' instead."],
			["SETTINGS","SETTINGS is depreciated. Please use 'QUICK-ACCESS' instead."],
			["QUICK-ACCESS","QUICK-ACCESS requires specialised hardware. Try 'STORE' for general installations."],
			["STORE","STORE is offline. For legacy software, use 'SOFTWARE-INSTALL-WISARD'."],
			["SOFTWARE-INSTALL-WISARD","SOFTWARE-INSTALL-WISARD is no longer supported. Try 'CMD' for program installs."]
		];
		
		var images = [
			[	
				"GOL_GOSPER_GLIDER_GUN.ASCII",
				"                                    ",
				"                                    ",
				"                                    ",
				"                                    ",
				"                        X           ",
				"                      X X           ",
				"            XX      XX            XX",
				"           X   X    XX            XX",
				"XX        X     X   XX              ",
				"XX        X   X XX    X X           ",
				"          X     X       X           ",
				"           X   X                    ",
				"            XX                      ",
				"                                    ",
				"                                    ",
				"                                    ",
				"                                    "
			],
			[
				"ONE_WITH_VOID.ASCII",
				"+++#########''++''++#++'+###########++++",
				"''''''''+'';''+''+++++##++++############",
				"'''''''''':'''''''''+#++#'+++###+++'''+'",
				"+++#++++#;;;;';''''''++#+++++####+++++''",
				"'''''''';;;';:;;++++++++####+#####+++###",
				"'''''''''+';;'+;'''''''++##########+++++",
				"'''''''''+;;;;;''';::;;;++#########+++++",
				"'''''''';'';;:;;:,,,,,::;;'++#######++++",
				"'''''''''';:..````....,,::;'''##@####+++",
				"'''''';'+'.``     ``..,,,:::;'+######+++",
				"'''''';';:        `.`.,,,,::;;+######+++",
				"''';''';;,      `````.,,,:::;;'+#####+++",
				";''''';':.       ````..,,::::;;'+####+++",
				";'';';'':`       ````..,,,::;;;'++###+'+",
				";;''';++;`  ``    ````.,,::;;;;'+####+++",
				";;''';+'' .::'',`` `...:;'+'+'''#####+++",
				";;';;;+';`,..,:;:,``.,:'++++'+''+####+++",
				";;';;;+'; ``.,:,..``,:;'';::::''+####+++",
				";;;;;;+': `:.'+;:`  ,;'';::;;;;''#@##+++",
				";;;;';;':`.#:@#''`` ,;'+;@+##';;'##+++++",
				";;;;;;;::  ``.,,`` `:''';:;;;;:;'#++++++",
				";;;;;;'`;` ``..``` .:;';::,:::;''#;#++++",
				";;;;;;'`,`  ``.`` `.;;;;:::,::;'++'#++++",
				";;;;;;;``    ``  ``.:;;:::,,,:;'#';+++++",
				";;;;;;':     ``.`  .,;'':,,,::;'';;+++++",
				";;;;;;;;``   `,` ``.:;;;;,,,::;';;++++++",
				":;;;;;;;;`  `,, `,.,;''';:,,::;';'##++++",
				":;;;;;;;;.  ,,    .:;;;;;;:,:;;'+###++++",
				":;;;;;;;;,  :`    `..,:;;;::,;;+++##++++",
				":;;;;;;;;:  ,:::.,,::;;;;;;,.;;+++##++++",
				";;;;;;;;;;  `,:.   `.::,'#,,,;;++##+#+++",
				";;;;;;';;;   ` ...  .,,:':,.;;'+++++++++",
				";;;:;::;;;`     `.,:;;:;':,:;;'#######++",
				":::;::;;;'`     ``.,,:;;;::;;''########@",
				",,:;:::;'+:`     `.::::;;::;''+########+",
				"::,:::;':'+``   ``.,:::;::;'''+########+",
				":::::::;':'``   ```..,:,;:''''#######+++",
				":;::::::;;;```    ``.,,:;;''+'#######+#+",
				":::;::::;;;.```  ``..,::;''''+########++",
				"::;;;::::;;...`.`...,::;'''''#########++"
			],
			[
				"QUBE.ASCII",
				"     QQQQQQQQQQQQQ",
				"   QQQQ        QQQ",
				" QQ QQ       QQ  Q",
				"QQQQQQQQQQQQQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQ    QQ    Q",
				"Q    QQQQQQQQQQQQQ",
				"Q  QQ      QQ  QQ ",
				"QQQ        QQQQ   ",
				"QQQQQQQQQQQQQ     "
			]
		]
		
		var textsReq = new XMLHttpRequest();
		textsReq.addEventListener("load", textsReqListener);
		textsReq.open("GET", "texts.json");
		textsReq.send(null);
		
		function textsReqListener () {
			texts = JSON.parse(this.responseText);
		}
		
		var pagesReq = new XMLHttpRequest();
		pagesReq.addEventListener("load", pagesReqListener);
		pagesReq.open("GET", "pages.json");
		pagesReq.send(null);
		
		function pagesReqListener () {
			pages = JSON.parse(this.responseText);
			start();
		}
		
		function terminalInput(input) {
			if(input=="BACKSPACE") {
				if(terminal.text.length > 0) {
					terminal.text = terminal.text.substring(0,terminal.text.length-1);
				}
			}
			else if(input=="ENTER") {
				terminalRun();
			}
			else {
				if(terminal.text.length < terminal.width-3) {
					terminal.text += input;
				}
			}
			terminalDisplay();
		}
		function terminalText(input) {
			if(input.length <= terminal.width-1) {
				terminal.prevText.push(input);
			}
			else {
				var mid = terminal.width;
				while(mid > 0 && input.charAt(mid) != " ") mid--;
				if(mid <= 0) mid = terminal.width-1;
				terminal.prevText.push(input.substring(0,mid));
				terminalText(input.substring(mid+1));
			}
		}
		function terminalRun() {
			terminalText(terminal.text);
			if(terminal.text != terminal.prevCommands[terminal.prevCommands.length-1]) terminal.prevCommands.push(terminal.text);
			
			//command stuff here
			var spaceIndex = terminal.text.indexOf(" ");
			if(spaceIndex == -1) spaceIndex = terminal.text.length;
			var command = terminal.text.substring(0,spaceIndex).toUpperCase();
			var subcommand = terminal.text.substring(spaceIndex+1).toUpperCase();
			var foundCommand = false;
			
			for(var i = 0; !foundCommand && i < simpleResponseCommands.length; i++) {
				if(command == simpleResponseCommands[i][0]) {
					terminalText(simpleResponseCommands[i][1]);
					foundCommand = true;
				}
			}
			
			if(!foundCommand) {
				switch(command) {
					case "CLS":
					case "CLEAR":
						terminal.prevText = [];
					break;
					case "GAME-OF-LIFE":
					case "GOL":
					case "GAMEOFLIFE":
						removeInput();
						setInterval(gameOfLife, 100);
					break;
					case "IMG":
							if(subcommand.length < 1) {
								terminalText("Valid Images:");
								for(var i = 0; i < images.length; i++) {
									terminalText(i + " : " + images[i][0]);
								}
								terminalText("Enter 'IMG' + NUM SELECTION to view");
							}
							else if(!isNaN(parseInt(subcommand)) && subcommand < images.length) {
								var img = images[subcommand];
								for(var i = 1; i < img.length; i++) {
									terminalText(img[i]);
								}
							}
							else {
								terminalText("Invalid image selection. Out of bounds or not a number.");
							}
					break;
					case "INTERNETEXPLORER":
					case "IE":
					case "INTERNET-EXPLORER":
						parent.style="position:absolute; cursor:none;";
						terminalText("Successfully loaded Internet-Explorer-Safe Module");
					break;
					case "PLAGUE":
						removeInput();
						setInterval(plague, 100);
					break;
					case "RAIN":
						removeInput();
						mouse.cursor = 'X';
						document.addEventListener("mousemove",mouseMove);
						setInterval(rain, 100);
					break;
					default:
						terminalText("'" + command + "' is not recognised as an internal or external command.");
					break;
				}
			}
			
			terminal.text = "";
		}
		function terminalDisplay() {
			while(terminal.prevText.length > terminal.lines-1) {
				terminal.prevText.shift();
			}
			pages[10].text = "";
			for(var i = 0; i < terminal.prevText.length; i++) {
				pages[10].text += terminal.prevText[i] + "~n";
			}
			pages[10].text += ">" + terminal.text + "█";
			update();
		}
		
		function removeInput() {
			document.removeEventListener("mousemove",mouseMove);
			document.removeEventListener("mousedown",mouseDown);
			document.removeEventListener("mouseup",mouseUp);
			document.removeEventListener("keydown",keyDown);
		}
		
		function gameOfLife() {
			var outputArray = new Array();
			for(var i = 0; i < outputWidth; i++) {
				outputArray.push(new Array());
				for(var j = 0; j < outputHeight; j++) {
					outputArray[i][j] = o[i][j];
				}
			}
			
			for(var i = 0; i < outputWidth; i= i+1) {
				for(var j = 0; j < outputHeight; j++) {
					var neighbors = 0;
					if(i > 0 && j > 0 && isLetterOrDigit(o[i-1][j-1])) neighbors++;
					if(i > 0 && isLetterOrDigit(o[i-1][j])) neighbors++;
					if(i > 0 && j < outputHeight-1 && isLetterOrDigit(o[i-1][j+1])) neighbors++;
					if(j > 0 && isLetterOrDigit(o[i][j-1])) neighbors++;
					if(j < outputHeight-1 && isLetterOrDigit(o[i][j+1])) neighbors++;
					if(i < outputWidth-1 && j > 0 && isLetterOrDigit(o[i+1][j-1])) neighbors++;
					if(i < outputWidth-1 && isLetterOrDigit(o[i+1][j])) neighbors++;
					if(i < outputWidth-1 && j < outputHeight-1 && isLetterOrDigit(o[i+1][j+1])) neighbors++;
					
					
					if(isLetterOrDigit(o[i][j]) && (neighbors < 2 || neighbors > 3)) {
						outputArray[i][j] = "&nbsp;";
					}
					else if(!isLetterOrDigit(o[i][j]) && (neighbors == 3)) {
						outputArray[i][j] = "X";
					}
					else {
						outputArray[i][j] = o[i][j];
					}
				}
			}
			for(var i = 0; i < outputWidth; i++) {
				for(var j = 0; j < outputHeight; j++) {
					o[i][j] = outputArray[i][j];
				}
			}
			blit();
		}
		
		function rain() {
			for(var i = 0; i < outputWidth; i++) {
				for(var j = outputHeight-3; j >= 0; j--) {
					if(isLetterOrDigit(o[i][j])) {
						var offset = Math.floor(Math.random()*3);
						o[i][j+offset] = o[i][j];
						if(offset!=0) o[i][j] = " ";
					}
				}
			}
			blit();
		}
		
		function plague() {
			for(var i = 0; i < outputWidth; i++) {
				for(var j = 0; j < outputHeight; j++) {
					if(isLetterOrDigit(o[i][j])) {
						var spread = Math.floor(Math.random()*10);
						if(spread < 1) {
							if(i > 0) o[i-1][j] = o[i][j];
							if(i < outputWidth-1) o[i+1][j] = o[i][j];
							if(j > 0) o[i][j-1] = o[i][j];
							if(j < outputHeight-1) o[i][j+1] = o[i][j];
						}
					}
				}
			}
			blit();
		}
		
		function isLetterOrDigit(ch) {
			return (ch.codePointAt(0) >= 65 && ch.codePointAt(0) <= 90) || (ch.codePointAt(0) >= 97 && ch.codePointAt(0) <= 122) || (ch.codePointAt(0) >= 48 && ch.codePointAt(0) <= 57);
		}
		
		function start() {
			
			for(var i = 0; i < outputWidth; i++) {
				o.push(new Array(outputHeight));
				for(var j = 0; j < outputWidth; j++) {
					o[i][j] = '#';
				}
			}
			
			for(var i = 0; i < pages.length; i++) {
				for(var j = 0; j < pages[i].links.length; j++) {
					var tempX = pages[i].posX + 1;
					var tempY = pages[i].posY + 1;
					hitboxes.push( [pages[i].links[j][0]+tempX,pages[i].links[j][1]+tempY,pages[i].links[j][2]+tempX,pages[i].links[j][3]+tempY,pages[i].links[j][4],pages[i].links[j][5],pages[i].links[j][6],pages[i].links[j][7],pages[i].links[j][8],i] );
				}
			}
			
			frame.src = "";
			image.style = "top:296px;left:504px;position:absolute;z-index:-1;display: none;";
			document.addEventListener("mousemove",mouseMove);
			document.addEventListener("mousedown",mouseDown);
			document.addEventListener("mouseup",mouseUp);
			document.addEventListener("keydown",keyDown);
			terminal.width = pages[10].width;
			terminal.lines = pages[10].height;
			pages[10].text = terminal.prevText[0] + "~n>";
			
			update();
			
			var wt = "Welcome. Use the mouse or keyboard to navigate the page.";
			fillspace(outputWidth/2 - wt.length/2,outputHeight/2-1,outputWidth/2 + wt.length/2+1,outputHeight/2+1,true,wt);
			blit();
		}
		
		function mouseMove(evt) {
			mouse.x = Math.min(Math.max(Math.floor((evt.clientX - parent.offsetLeft) / main.clientWidth * outputWidth),0),outputWidth-1);
			mouse.y = Math.min(Math.max(Math.floor((evt.clientY - parent.offsetTop) / main.clientHeight * outputHeight),0),outputHeight-1);
			moveCursorEfficient();
		}
		
		function moveCursorEfficient() {
			o[mouse.oldX][mouse.oldY] = mouse.under;
			mouse.under = o[mouse.x][mouse.y];
			mouse.oldX = mouse.x;
			mouse.oldY = mouse.y;
			o[mouse.x][mouse.y] = mouse.cursor;
			blit();
		}
		
		function mouseDown(evt) {
			for(var i = 0; i < hitboxes.length; i++) {
				if(pages[hitboxes[i][9]].enabled && hitboxes[i][0] <= mouse.x && hitboxes[i][1] <= mouse.y && hitboxes[i][2] >= mouse.x && hitboxes[i][3] >= mouse.y) {
					draw.drawInvert = true;
					draw.hitbox = i;
					if(hitboxes[i][4] != null) {
						for(var j = 0; j < hitboxes[i][4].length; j++) {
							flicker(hitboxes[i][4][j]);
						}
					}
					if(hitboxes[i][5] != null) {
						for(var j = 0; j < hitboxes[i][5].length; j++) {
							setPage(hitboxes[i][5][j]);
						}
					}
					if(hitboxes[i][6] != null) {
						for(var j = 0; j < hitboxes[i][6].length; j++) {
							pages[hitboxes[i][6][j]].enabled=true;
						}
					}
					if(hitboxes[i][7] != null) {
						for(var j = 0; j < hitboxes[i][7].length; j++) {
							pages[hitboxes[i][7][j]].enabled=false;
						}
					}
					if(hitboxes[i][8] != null) {
						for(var j = 0; j < hitboxes[i][8].length; j++) {
							if (hitboxes[i][8][j] == "PAGELINK") openLink();
							else openLink(hitboxes[i][8][j]);
						}
					}
				}
				update();
			}
		}	
		
		function mouseUp(evt) {
			draw.drawInvert = false;
			update();
			moveCursorEfficient();
		}
		
		function keyDown(evt) {
			if(pages[10].enabled) {
				var code = evt.keyCode;
				if(code == 8) terminalInput("BACKSPACE");
				if(code == 13) terminalInput("ENTER");
				if(code == 32) terminalInput(" ");
				if(code == 173 || code == 189) terminalInput("-");
				if(code == 190) terminalInput(".");
				if(code >= 48 && code <= 90) terminalInput(String.fromCharCode(code));
			}
			else {
				switch(evt.keyCode) {
					case 38:
						mouse.y = Math.min(Math.max(mouse.y-1,0),outputHeight-1);
						moveCursorEfficient();
					break;
					case 40:
						mouse.y = Math.min(Math.max(mouse.y+1,0),outputHeight-1);
						moveCursorEfficient();
					break;
					case 37:
						mouse.x = Math.min(Math.max(mouse.x-1,0),outputWidth-1);
						moveCursorEfficient();
					break;
					case 39:
						mouse.x = Math.min(Math.max(mouse.x+1,0),outputWidth-1);
						moveCursorEfficient();
					break;
					case 13:
						mouseDown();
						setTimeout(mouseUp,100);
						update();
					break;
				}
			}
		}
		
		function text(t, x, y, wrap, maxX) {
			if(typeof wrap === "undefined") wrap = true;
			if(typeof maxX === "undefined") maxX = outputWidth-1;
			var initX = x;
			for(var i = 0; i < t.length; i++) {
				while(t.charAt(i) == '~' && t.charAt(i+1) == 'n') {
					x = initX;
					y++;
					i += 2;
				}
				o[x][y] = t.charAt(i);
				x++;
				if(wrap && x > maxX) {
					x = initX;
					y++;
				}
			}
		}
		
		function fillspace(startX, startY, endX, endY, border, fillchar, invert) {
			if(typeof border === "undefined") border = false;
			if(typeof fillchar === "undefined" || fillchar == "") fillchar = "&nbsp;";
			if(typeof invert === "undefined") invert = false;
			
			if(!invert && fillchar != "~t") {
				if(fillchar.length <= 1 || fillchar == "&nbsp;") {
					for(var i = startX; i <= endX; i++) {
						for(var j = startY; j < endY; j++) {
							o[i][j] = fillchar;
						}
					}
				}
				else {
					for(var i = startX; i <= endX; i++) {
						for(var j = startY; j < endY; j++) {
							o[i][j] = '&nbsp;';
						}
					}
					text(fillchar, startX+1, startY+1, true, endX - 1)
				}
			}
			
			if(border) {
				o[startX][startY] = '┌';
				o[endX][startY] = '┐';
				o[startX][endY] = '└';
				o[endX][endY] = '┘';
				for(var i = startX + 1; i < endX; i++) {
					o[i][startY] = '─';
					o[i][endY] = '─';
				}
				for(var i = startY + 1; i < endY; i++) {
					o[startX][i] = '│';
					o[endX][i] = '│';
				}
			}
			
			if(invert) {
				for(var i = startX; i <= endX; i++) {
					for(var j = startY; j <= endY; j++) {
						o[i][j] = ("<istart>" + o[i][j] + "<iend>");
					}
				}
			}
		}
		
		function flicker(pageId, perms) {
			if(typeof perms === "undefined") perms = 1;
			pages[pageId].enabled = !pages[pageId].enabled;
			update();
			if(perms > 1) setTimeout(flicker,20,pageId,perms-1);
		}
		
		function setPage(index) {
			if(typeof index === "boolean") {
				pageImg = index;
				setPage();
			}
			else if(index == pageIndex || index == "CLOSE") {
				pages[11].enabled = false;
				pages[12].enabled = false;
				pages[13].enabled = false;
				pages[14].enabled = false;
				pages[15].enabled = false;
				pageIndex = -1;
				frame.style = "top:296px;left:504px;position:absolute;z-index:-1;";
				frame.src = "";
				image.style = "top:296px;left:504px;position:absolute;z-index:-1;display: none;";
			}
			else {
				if(!(typeof index === "undefined")) {
					pageIndex = index;
					pageImg = false;
				}
				pages[11].enabled = true;
				pages[12].enabled = true;
				pages[13].enabled = true;
				pages[14].enabled = true;
				pages[15].enabled = true;
				pages[11].text = texts[pageIndex][0];
				
				pages[10].enabled = false;
				
				if(texts[pageIndex][1] == "") {
					pages[15].enabled = false;
					pageImg = true;
				}
				
				if(texts[pageIndex][3] == "") {
					pages[14].enabled = false;
					pageImg = false;
				}
				
				frame.style = "top:296px;left:504px;position:absolute;z-index:-1;";
				frame.src = "";
				image.style = "top:296px;left:504px;position:absolute;z-index:-1;display: none;";
				
				if(pageImg) {
					image.src = texts[pageIndex][3];
					image.style = "top:296px;left:504px;position:absolute;z-index:-1;display: inline-block;";
				}
				else {
					frame.style = "top:296px;left:504px;position:absolute;z-index:1;";
					frame.src = texts[pageIndex][1];
				}
			}
			
		}
		
		function openLink(link) {
			if(typeof link === "undefined" && pageIndex > -1) link = texts[pageIndex][2]; 
			window.open(link,'_blank');
			mouseUp();
		}
		
		function update() {
			document.body.style = ("overflow:hidden; color:" + draw.foreground + "; background-color:" + draw.background  + ";");
			fillspace(0,0,outputWidth-1,outputHeight-1,true,'-');			
			for(var i = 0; i < pages.length; i++)
				if(pages[i].enabled)
					fillspace(pages[i].posX, pages[i].posY, pages[i].posX + pages[i].width + 1, pages[i].posY + pages[i].height + 1, true, pages[i].text);
			if(draw.drawInvert) 
				fillspace(hitboxes[draw.hitbox][0]-1,hitboxes[draw.hitbox][1]-1,hitboxes[draw.hitbox][2]+1,hitboxes[draw.hitbox][3]+1,false,'-',true);
			blit();
		}
		
		function blit() {
			var temp = "";
			for(var i = 0; i < outputHeight; i++) {
				for(var j = 0; j < outputWidth; j++) {
					temp += o[j][i];
				}
				temp += "<br/>";
			}
			main.innerHTML = temp.replace(/ /g,"&nbsp;").replace(/<istart>/g,"<span style='color:" + draw.background + "; background-color:" + draw.foreground + ";'>").replace(/<iend>/g,"</span>");
		}
	</script>
</body>
</html>